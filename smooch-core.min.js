!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.SmoochCore=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}exports.__esModule=!0,exports.AppUsersApi=void 0;var _base=require("./base"),_appUsersStripe=require("./appUsersStripe"),_appUsersViber=require("./appUsersViber"),_appUsersWeChat=require("./appUsersWeChat"),_smoochMethod=require("../utils/smoochMethod"),_smoochMethod2=_interopRequireDefault(_smoochMethod),AppUsersApi=exports.AppUsersApi=function(e){function t(){_classCallCheck(this,t);for(var r=arguments.length,s=Array(r),a=0;r>a;a++)s[a]=arguments[a];var o=_possibleConstructorReturn(this,e.call.apply(e,[this].concat(s)));return o.stripe=new(Function.prototype.bind.apply(_appUsersStripe.AppUsersStripeApi,[null].concat(s))),o.viber=new(Function.prototype.bind.apply(_appUsersViber.AppUsersViberApi,[null].concat(s))),o.wechat=new(Function.prototype.bind.apply(_appUsersWeChat.AppUsersWeChatApi,[null].concat(s))),o}return _inherits(t,e),t}(_base.BaseApi);Object.assign(AppUsersApi.prototype,{init:_smoochMethod2.default({params:["props"],path:"/init",method:"POST"}),create:_smoochMethod2.default({params:["userId","props"],optional:["props"],path:"/appusers",func:function(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!t||!t.trim())return Promise.reject(new Error("Must provide a userId."));var s=Object.assign({userId:t},r);return!r.signedUpAt||r.signedUpAt instanceof Date?this.request("POST",e,s,{allowedAuth:["jwt"]}):Promise.reject(new Error("signedUpAt must be a date."))}}),get:_smoochMethod2.default({params:["userId"],path:"/appusers/:userId",method:"GET"}),update:_smoochMethod2.default({params:["userId","props"],path:"/appusers/:userId",method:"PUT"}),trackEvent:_smoochMethod2.default({params:["userId","eventName","props"],optional:["props"],path:"/appusers/:userId/events",func:function(e,t,r){var s=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];return this.request("POST",e,{name:r,appUser:s})}}),updatePushToken:_smoochMethod2.default({params:["userId","deviceId","token"],path:"/appusers/:userId/pushToken",func:function(e,t,r,s){return this.request("POST",e,{deviceId:r,token:s})}}),updateDevice:_smoochMethod2.default({params:["userId","deviceId","props"],path:"/appusers/:userId/devices/:deviceId",method:"PUT"}),linkChannel:_smoochMethod2.default({params:["userId","data"],path:"/appusers/:userId/channels",method:"POST"}),unlinkChannel:_smoochMethod2.default({params:["userId","channel"],path:"/appusers/:userId/channels/:channel",method:"DELETE"}),pingChannel:_smoochMethod2.default({params:["userId","channel"],path:"/appusers/:userId/integrations/:channel/ping",func:function(e){return this.request("POST",e)}}),getMessages:_smoochMethod2.default({params:["userId","query"],optional:["query"],path:"/appusers/:userId/messages",func:function(e){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=r.before,a=r.after;if(s&&a)return Promise.reject(new Error('Parameters "before" and "after" are mutually exclusive. You must provide one or the other.'));var o=s?{before:s}:a?{after:a}:void 0;return this.request("GET",e,o)}}),sendMessage:_smoochMethod2.default({params:["userId","message"],path:"/appusers/:userId/messages",method:"POST"}),uploadImage:_smoochMethod2.default({params:["userId","source","message"],optional:["message"],path:"/appusers/:userId/images",func:function(e,t,r){var s=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],a=new FormData;return a.append("source",r),Object.keys(s).forEach(function(e){a.append(e,s[e])}),this.request("POST",e,a)}}),deleteMessages:_smoochMethod2.default({params:["userId"],path:"/appusers/:userId/messages",func:function(e,t){return t&&t.trim()?this.request("DELETE",e,{},{allowedAuth:["jwt"]}):Promise.reject(new Error("Must provide a userId."))}}),typingActivity:_smoochMethod2.default({params:["userId","activityProps"],path:"/appusers/:userId/conversation/activity",method:"POST"}),deleteProfile:_smoochMethod2.default({params:["userId"],path:"/appusers/:userId/profile",func:function(e,t){return t&&t.trim()?this.request("DELETE",e,{},{allowedAuth:["jwt"]}):Promise.reject(new Error("Must provide a userId."))}}),transferRequest:_smoochMethod2.default({params:["userId","channel"],path:"/appusers/:userId/transferrequest",func:function(e,t,r){return this.request("GET",e,{type:r.type})}})})},{"../utils/smoochMethod":11,"./appUsersStripe":2,"./appUsersViber":3,"./appUsersWeChat":4,"./base":5}],2:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}exports.__esModule=!0,exports.AppUsersStripeApi=void 0;var _base=require("./base"),_smoochMethod=require("../utils/smoochMethod"),_smoochMethod2=_interopRequireDefault(_smoochMethod),AppUsersStripeApi=exports.AppUsersStripeApi=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(t,e),t}(_base.BaseApi);Object.assign(AppUsersStripeApi.prototype,{updateCustomer:_smoochMethod2.default({params:["userId","token"],path:"/appusers/:userId/stripe/customer",func:function(e,t,r){return r?this.request("POST",e,{token:r},{allowedAuth:["jwt"]}):Promise.reject(new Error("Must provide a Stripe token."))}}),createTransaction:_smoochMethod2.default({params:["userId","actionId","token"],optional:["token"],path:"/appusers/:userId/stripe/transaction",func:function(e,t,r,o){if(!r)return Promise.reject(new Error("Must provide an action id."));var s={actionId:r};return o&&Object.assign(s,{token:o}),this.request("POST",e,s)}})})},{"../utils/smoochMethod":11,"./base":5}],3:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}exports.__esModule=!0,exports.AppUsersViberApi=void 0;var _base=require("./base"),_smoochMethod=require("../utils/smoochMethod"),_smoochMethod2=_interopRequireDefault(_smoochMethod),AppUsersViberApi=exports.AppUsersViberApi=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(t,e),t}(_base.BaseApi);Object.assign(AppUsersViberApi.prototype,{getQRCode:_smoochMethod2.default({params:["userId"],path:"/appusers/:userId/integrations/viber/qrcode",method:"GET"})})},{"../utils/smoochMethod":11,"./base":5}],4:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}exports.__esModule=!0,exports.AppUsersWeChatApi=void 0;var _base=require("./base"),_smoochMethod=require("../utils/smoochMethod"),_smoochMethod2=_interopRequireDefault(_smoochMethod),AppUsersWeChatApi=exports.AppUsersWeChatApi=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(t,e),t}(_base.BaseApi);Object.assign(AppUsersWeChatApi.prototype,{getQRCode:_smoochMethod2.default({params:["userId"],path:"/appusers/:userId/integrations/wechat/qrcode",method:"GET"})})},{"../utils/smoochMethod":11,"./base":5}],5:[function(require,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0,exports.BaseApi=void 0;{var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},_http=require("../utils/http");exports.BaseApi=function(){function t(e,r,s,n,a){_classCallCheck(this,t),this.serviceUrl=e,this.authHeaders=r,this.headers=s,this.requireAppId=!!n,this.httpAgent=a,this.allowedAuth=["jwt","appToken"]}return t.prototype.validateAuthHeaders=function(){var t=arguments.length<=0||void 0===arguments[0]?this.allowedAuth:arguments[0];if(!t||0===t.length)return Promise.reject(new Error("Must at least provide one authentication method."));if(!this.authHeaders)return Promise.reject(new Error("Must provide headers."));var e=t.indexOf("jwt")>=0,r=t.indexOf("appToken")>=0,s=!!this.authHeaders.Authorization,n=!!this.authHeaders["app-token"];return!e&&s?Promise.reject(new Error("Must not use JWT for authentication.")):!r&&n?Promise.reject(new Error("Must not use an app token for authentication.")):Promise.resolve()},t.prototype.request=function(t,e,r){var s=this,n=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],a=n.allowedAuth,o=void 0===a?this.allowedAuth:a;return this.validateAuthHeaders(o).then(function(){return _http.http(t,e,r,s.getHeaders(),s.httpAgent)})},t.prototype.getHeaders=function(){return _extends({},this.headers,this.authHeaders)},t}()}},{"../utils/http":10}],6:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}exports.__esModule=!0,exports.ConversationsApi=void 0;var _base=require("./base"),_smoochMethod=require("../utils/smoochMethod"),_smoochMethod2=_interopRequireDefault(_smoochMethod),ConversationsApi=exports.ConversationsApi=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(t,e),t}(_base.BaseApi);Object.assign(ConversationsApi.prototype,{get:_smoochMethod2.default({params:["userId"],path:"/appusers/:userId/conversation",method:"GET"}),postPostback:_smoochMethod2.default({params:["userId","actionId"],path:"/appusers/:userId/conversation/postback",func:function(e,t,r){if(!r)return Promise.reject(new Error("Must provide an action id."));var o={actionId:r};return this.request("POST",e,o)}}),resetUnreadCount:_smoochMethod2.default({params:["userId"],path:"/appusers/:userId/conversation/read",func:function(e){return this.request("POST",e)}}),sendMessage:function(){return Promise.reject(new Error("This endpoint is deprecated. Please use appUsers.sendMessage() instead."))},uploadImage:function(){return Promise.reject(new Error("This endpoint is deprecated. Please use appUsers.uploadImage() instead."))}})},{"../utils/smoochMethod":11,"./base":5}],7:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}exports.__esModule=!0,exports.StripeApi=void 0;var _base=require("./base"),_smoochMethod=require("../utils/smoochMethod"),_smoochMethod2=_interopRequireDefault(_smoochMethod),StripeApi=exports.StripeApi=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,e.apply(this,arguments))}return _inherits(t,e),t}(_base.BaseApi);Object.assign(StripeApi.prototype,{getAccount:_smoochMethod2.default({params:[],path:"/stripe/account",method:"GET"})})},{"../utils/smoochMethod":11,"./base":5}],8:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0,exports.Smooch=exports.SERVICE_URL=void 0;{var _auth=require("./utils/auth"),_appUsers=require("./api/appUsers"),_conversations=require("./api/conversations"),_stripe=require("./api/stripe"),_package=require("../package.json"),_package2=_interopRequireDefault(_package),SERVICE_URL=exports.SERVICE_URL="https://api.smooch.io/v1";exports.Smooch=function e(){var s=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,e);var r=t.serviceUrl,i=void 0===r?SERVICE_URL:r,a=t.headers,h=void 0===a?{}:a,o=t.httpAgent;if(this.VERSION=_package2.default.version,this.serviceUrl=i,this.scope="appUser",s.keyId||s.secret)throw new Error("Key Id or Secret should not be used on the browser side. You must generate a JWT beforehand.");this.headers=h,this.httpAgent=o,this.authHeaders=_auth.getAuthenticationHeaders(s),this.appUsers=new _appUsers.AppUsersApi(this.serviceUrl,this.authHeaders,this.headers,!1,this.httpAgent),this.conversations=new _conversations.ConversationsApi(this.serviceUrl,this.authHeaders,!1,this.headers,this.httpAgent),this.stripe=new _stripe.StripeApi(this.serviceUrl,this.authHeaders,this.headers,!1,this.httpAgent),this.utils={}}}},{"../package.json":15,"./api/appUsers":1,"./api/conversations":6,"./api/stripe":7,"./utils/auth":9}],9:[function(require,module,exports){"use strict";function getAuthenticationHeaders(t){if(!t)throw new Error("Must provide authentication information.");if(t.jwt)return{Authorization:"Bearer "+t.jwt};if(t.appToken)return{"app-token":t.appToken};throw new Error("Must provide a JWT or a app token")}exports.__esModule=!0,exports.getAuthenticationHeaders=getAuthenticationHeaders},{}],10:[function(require,module,exports){(function(process){"use strict";function stringifyGETParams(e,t){var n=Object.keys(t).reduce(function(e,n){return null!==t[n]?e+"&"+encodeURIComponent(n)+"="+encodeURIComponent(t[n]):e},"");return n&&(e+=(~e.indexOf("?")?"&":"?")+n.substring(1)),e}function handleResponse(e){if(202===e.status||204===e.status)return Promise.resolve();var t=e.headers.get("Content-Type")||"",n=t.indexOf("application/json")>-1;if(e.status>=200&&e.status<300)return n?e.json():Promise.resolve();if(n)return e.json().then(function(t){var n=t.error,s=void 0===n?{}:n,r=new Error(s.description||e.statusText);throw r.response=e,r.code=s.code,r.description=s.description,r});var s=new Error(e.statusText);return s.response=e,Promise.reject(s)}function http(e,t,n){var s=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],r=arguments[4];e=e.toUpperCase();var o={method:e,headers:Object.assign({Accept:"application/json","Content-Type":"application/json"},s)};return r&&(o.agent=r),n&&(n instanceof FormData?(o.body=n,delete o.headers["Content-Type"]):(n=Object.assign({},n),"GET"===e?t=stringifyGETParams(t,n):"POST"!==e&&"PUT"!==e||(o.body=JSON.stringify(n)))),fetch(t,o).then(handleResponse)}exports.__esModule=!0,exports.stringifyGETParams=stringifyGETParams,exports.handleResponse=handleResponse,exports.http=http,"undefined"!=typeof process&&require("isomorphic-fetch")}).call(this,require("_process"))},{_process:13,"isomorphic-fetch":12}],11:[function(require,module,exports){"use strict";function smoochMethod(e){var r=e.params,t=e.optional,o=void 0===t?[]:t,n=e.path,i=e.method,a=e.func;if(!r||!n)throw new Error("params and path are required");if(!i&&!a)throw new Error("at least one of func or method are required");if(i&&a)throw new Error("func and method are mutually exclusive");var c=a?a.name:i+" "+n;return function(){var e=arguments,t=void 0,u=void 0,p=n;this.requireAppId?(u=["appId"].concat(r),p="/apps/:appId"+n):u=[].concat(r);var s=u.filter(function(e){return!o.includes(e)});if("object"===_typeof(arguments[0])&&1===arguments.length?!function(){var r=e[0];u.includes("props")&&"object"!==_typeof(r.props)?t=[r]:(t=[],u.forEach(function(e){var o=r[e],n=s.includes(e);if(!o&&n)throw new Error(c+": missing required argument: "+e);o&&t.push(o)}))}():t=[].concat(Array.prototype.slice.call(arguments)),t.length<s.length)throw new Error(c+": incorrect number of parameters ("+t.length+"). Expected at least "+s.length);if(t.length>u.length)throw new Error(c+": incorrect number of parameters ("+t.length+"). Expected at most "+r.length);u.forEach(function(e,r){t[r]&&p.includes(":"+e)&&(p=p.replace(":"+e,t[r]))});var f=this.serviceUrl+p;return i?["POST","PUT"].includes(i)?this.request(i,f,t.pop()):this.request(i,f):(this.requireAppId?t[0]=f:t.unshift(f),a.apply(this,t))}}exports.__esModule=!0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};exports.default=smoochMethod},{}],12:[function(require,module){require("whatwg-fetch"),module.exports=self.fetch.bind(self)},{"whatwg-fetch":14}],13:[function(require,module){function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=setTimeout(cleanUpNextTick);draining=!0;for(var n=queue.length;n;){for(currentQueue=queue,queue=[];++queueIndex<n;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,n=queue.length}currentQueue=null,draining=!1,clearTimeout(e)}}function Item(e,n){this.fun=e,this.array=n}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];queue.push(new Item(e,n)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],14:[function(){!function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function r(t){return"string"!=typeof t&&(t=String(t)),t}function o(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return y.iterable&&(e[Symbol.iterator]=function(){return e}),e}function n(t){this.map={},t instanceof n?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function s(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function i(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function a(t){var e=new FileReader;return e.readAsArrayBuffer(t),i(e)}function h(t){var e=new FileReader;return e.readAsText(t),i(e)}function u(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(y.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(y.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(t){if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob?(this.blob=function(){var t=s(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(a)},this.text=function(){var t=s(this);if(t)return t;if(this._bodyBlob)return h(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=s(this);return t?t:Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(t){var e=t.toUpperCase();return b.indexOf(e)>-1?e:t}function d(t,e){e=e||{};var r=e.body;if(d.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new n(t.headers)),this.method=t.method,this.mode=t.mode,r||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new n(e.headers)),this.method=f(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),o=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(o),decodeURIComponent(n))}}),e}function c(t){var e=new n,r=(t.getAllResponseHeaders()||"").trim().split("\n");return r.forEach(function(t){var r=t.trim().split(":"),o=r.shift().trim(),n=r.join(":").trim();e.append(o,n)}),e}function l(t,e){e||(e={}),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof n?e.headers:new n(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var y={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};n.prototype.append=function(t,o){t=e(t),o=r(o);var n=this.map[t];n||(n=[],this.map[t]=n),n.push(o)},n.prototype.delete=function(t){delete this.map[e(t)]},n.prototype.get=function(t){var r=this.map[e(t)];return r?r[0]:null},n.prototype.getAll=function(t){return this.map[e(t)]||[]},n.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},n.prototype.set=function(t,o){this.map[e(t)]=[r(o)]},n.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(o){t.call(e,o,r,this)},this)},this)},n.prototype.keys=function(){var t=[];return this.forEach(function(e,r){t.push(r)}),o(t)},n.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),o(t)},n.prototype.entries=function(){var t=[];return this.forEach(function(e,r){t.push([r,e])}),o(t)},y.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this)},u.call(d.prototype),u.call(l.prototype),l.prototype.clone=function(){return new l(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},l.error=function(){var t=new l(null,{status:0,statusText:""});return t.type="error",t};var m=[301,302,303,307,308];l.redirect=function(t,e){if(-1===m.indexOf(e))throw new RangeError("Invalid status code");return new l(null,{status:e,headers:{location:t}})},t.Headers=n,t.Request=d,t.Response=l,t.fetch=function(t,e){return new Promise(function(r,o){function n(){return"responseURL"in i?i.responseURL:/^X-Request-URL:/m.test(i.getAllResponseHeaders())?i.getResponseHeader("X-Request-URL"):void 0}var s;s=d.prototype.isPrototypeOf(t)&&!e?t:new d(t,e);var i=new XMLHttpRequest;i.onload=function(){var t={status:i.status,statusText:i.statusText,headers:c(i),url:n()},e="response"in i?i.response:i.responseText;r(new l(e,t))},i.onerror=function(){o(new TypeError("Network request failed"))},i.ontimeout=function(){o(new TypeError("Network request failed"))},i.open(s.method,s.url,!0),"include"===s.credentials&&(i.withCredentials=!0),"responseType"in i&&y.blob&&(i.responseType="blob"),s.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send("undefined"==typeof s._bodyInit?null:s._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},{}],15:[function(require,module){module.exports={name:"smooch-core",version:"4.2.0",description:"Javascript wrapper for Smooch API",homepage:"https://smooch.io",main:"lib/wrappers/node.js",browser:"lib/wrappers/browser.js",scripts:{test:"mocha --compilers js:babel-core/register --require ./test-setup.js ./test/**/*.spec.js","test-ci":"MOCHA_FILE=$CIRCLE_TEST_REPORTS/test-results.xml mocha --compilers js:babel-core/register -R mocha-junit-reporter --require ./test-setup.js ./test/**/*.spec.js",build:"mkdir -p lib && rm -rf lib/* && babel -d lib/ src/ && npm run browserify:dist","browserify:dev":"mkdir -p amd && browserify -g uglifyify -e lib/smooch.js -s SmoochCore -o amd/smooch-core.js","browserify:dist":"npm run browserify:dev && uglifyjs amd/smooch-core.js -c -o amd/smooch-core.min.js --screw-ie8",release:"release",docs:"jsdoc src/api -t node_modules/minami",lint:"eslint . --ext=js"},author:"Marc-Antoine Lemieux",license:"MIT",repository:{type:"git",url:"git@github.com:smooch/smooch-core-js.git"},devDependencies:{babel:"6.5.2","babel-cli":"6.9.0","babel-core":"6.9.0","babel-eslint":"6.0.4","babel-preset-es2015":"6.9.0","babel-preset-es2015-loose":"7.0.0","babel-preset-stage-2":"6.5.0",browserify:"12.0.1",chai:"4.0.2","chai-as-promised":"7.0.0",esformatter:"0.9.2","esformatter-braces":"1.2.1","esformatter-dot-notation":"1.3.1","esformatter-quotes":"1.0.3",eslint:"2.3.0","estraverse-fb":"1.3.1",hat:"0.0.3",minami:"1.1.1",mocha:"2.3.3","mocha-junit-reporter":"1.9.0","release-script":"0.5.4",should:"7.1.1",sinon:"2.3.5","sinon-chai":"2.11.0",streamifier:"0.1.1",uglifyify:"3.0.1",uglifyjs:"2.4.10"},dependencies:{"form-data":"0.2.0","isomorphic-fetch":"2.2.0",jsonwebtoken:"5.4.1"},"release-script":{bowerRepo:"git@github.com:smooch/smooch-core-js-bower.git"}}},{}]},{},[8])(8)});